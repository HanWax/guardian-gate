{
  "project": "RoleCall - Nursery Settings Page",
  "branchName": "compound/nursery-settings-page",
  "description": "Build a settings page for admins/managers to configure nursery timing parameters and timezone",
  "tasks": [
    {
      "id": "T-001",
      "title": "Create nursery settings Zod schema",
      "description": "Define Zod validation schema for nursery settings fields (dropoff_start, dropoff_end, first_message_time, second_ping_time, timezone)",
      "acceptanceCriteria": [
        "File src/lib/schemas/nursery.ts created",
        "File contains updateNurserySettingsSchema export",
        "Schema validates dropoff_start as time format (HH:mm)",
        "Schema validates dropoff_end as time format (HH:mm)",
        "Schema validates first_message_time as time format (HH:mm)",
        "Schema validates second_ping_time as time format (HH:mm)",
        "Schema validates timezone as non-empty string",
        "Run `npm run typecheck` - exits with code 0"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-002",
      "title": "Create updateNurserySettings server function",
      "description": "Implement server function to update nursery settings using service-role client and access token verification",
      "acceptanceCriteria": [
        "File src/lib/server/nurseries.ts created",
        "Export updateNurserySettings function",
        "Function accepts accessToken parameter",
        "Function accepts validated nursery settings data",
        "Function creates service client with SUPABASE_SERVICE_ROLE_KEY",
        "Function verifies auth via access token",
        "Function updates nurseries table with provided data",
        "Function returns updated nursery record or throws error",
        "Run `npm run typecheck` - exits with code 0"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-003",
      "title": "Create nurseries query hooks",
      "description": "Implement React Query hooks for fetching and updating nursery settings following established patterns",
      "acceptanceCriteria": [
        "File src/lib/queries/nurseries.ts created",
        "Export nurseriesKeys factory with detail function",
        "Export useNurserySettings(nurseryId) hook",
        "useNurserySettings hook uses React Query useQuery",
        "useNurserySettings hook fetches from /api/nurseries/:id OR server function",
        "Export useUpdateNurserySettings() mutation hook",
        "useUpdateNurserySettings uses getAccessToken() from queries/utils.ts",
        "useUpdateNurserySettings calls updateNurserySettings server function",
        "useUpdateNurserySettings invalidates nursery query on success",
        "Run `npm run typecheck` - exits with code 0"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-004",
      "title": "Create settings route file",
      "description": "Create /settings route file with route protection and beforeLoad guard",
      "acceptanceCriteria": [
        "File src/routes/settings.tsx created",
        "Route exports createFileRoute with path '/settings'",
        "Route has beforeLoad property with requireAuth() call",
        "requireAuth() guards against unauthenticated access",
        "Run `npm run typecheck` - exits with code 0",
        "Dev server running - routeTree.gen.ts includes settings route"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-005",
      "title": "Build nursery settings form component",
      "description": "Create form component displaying all nursery timing fields with proper input types",
      "acceptanceCriteria": [
        "Form component renders in src/routes/settings.tsx",
        "Form displays dropoff_start field with time input type",
        "Form displays dropoff_end field with time input type",
        "Form displays first_message_time field with time input type",
        "Form displays second_ping_time field with time input type",
        "Form displays timezone field with select dropdown",
        "Timezone select includes at minimum: Asia/Jerusalem, UTC options",
        "Form loads and displays current nursery values from useNurserySettings hook",
        "Run `npm run typecheck` - exits with code 0"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-006",
      "title": "Implement form validation with Zod schema",
      "description": "Add validation logic to form using Zod schema and display Hebrew error messages",
      "acceptanceCriteria": [
        "Form validates fields against updateNurserySettingsSchema",
        "Invalid time format triggers validation error",
        "Invalid timezone triggers validation error",
        "Error messages displayed in Hebrew",
        "Form uses getHebrewErrorMessage() for error translation",
        "Validation errors display on field level or form level",
        "Run `npm run lint` - exits with code 0",
        "Run `npm run typecheck` - exits with code 0"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-007",
      "title": "Implement form submission with mutation",
      "description": "Connect form submit to useUpdateNurserySettings mutation hook",
      "acceptanceCriteria": [
        "Form has submit button",
        "Form submit calls useUpdateNurserySettings mutation",
        "Mutation passes validated data to server function",
        "Mutation includes loading state during submission",
        "On success: display Hebrew success message/toast",
        "On error: display Hebrew error message/toast",
        "Form disables submit button during loading",
        "Run `npm run typecheck` - exits with code 0"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "T-008",
      "title": "Apply RTL-compatible CSS styling",
      "description": "Style form with logical CSS properties for Hebrew RTL layout",
      "acceptanceCriteria": [
        "Form uses logical padding: ps-* or pe-* (not pl-*, pr-*)",
        "Form uses logical margins: ms-* or me-* (not ml-*, mr-*)",
        "Form uses text-start (not text-left)",
        "Form uses logical space between fields",
        "All layout is visually correct in RTL mode",
        "Run `npm run lint` - exits with code 0"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "T-009",
      "title": "Run quality checks on implementation",
      "description": "Verify all linting, testing, and type checking passes",
      "acceptanceCriteria": [
        "Run `npm run lint` - exits with code 0",
        "Run `npm run test` - exits with code 0",
        "Run `npm run typecheck` - exits with code 0",
        "No new console errors or warnings"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "T-010",
      "title": "Add settings link to sidebar navigation",
      "description": "Add navigation link to settings page in sidebar, visible only to admin/manager roles",
      "acceptanceCriteria": [
        "Find sidebar/navigation component",
        "Add new link with href='/settings'",
        "Link text is Hebrew: 'הגדרות משתלה'",
        "Link visibility conditional: show for admin and manager roles only",
        "Link not visible for teacher role",
        "Use requireRole or role-based conditional rendering",
        "Run `npm run typecheck` - exits with code 0",
        "Run `npm run lint` - exits with code 0"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "T-011",
      "title": "Test settings form in browser (desktop)",
      "description": "Verify form loads, displays values, validates, and submits successfully on desktop",
      "acceptanceCriteria": [
        "Start dev server: npm run dev",
        "Login as admin or manager user",
        "Navigate to /settings via sidebar link - page loads without errors",
        "Form displays current nursery values in all fields",
        "Modify dropoff_start field to invalid value - error message appears in Hebrew",
        "Correct the invalid value - error disappears",
        "Fill all fields with valid test values",
        "Click submit button - loading state appears then success message in Hebrew",
        "Browser console shows no errors during interaction"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "T-012",
      "title": "Verify settings link visibility and navigation",
      "description": "Confirm settings link appears/hides correctly based on role and navigates properly",
      "acceptanceCriteria": [
        "Login as admin user - settings link visible in sidebar",
        "Click settings link - navigates to /settings without errors",
        "Logout and login as manager user - settings link visible in sidebar",
        "Logout and login as teacher user - settings link NOT visible in sidebar",
        "Navigate directly to /settings as teacher - redirected to appropriate page (or error)",
        "Browser console shows no errors during role transitions"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    }
  ]
}
